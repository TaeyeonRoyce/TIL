# DNS

리졸버가 DNS서버와 통신하며 도메인에 해당되는 IP주소를 받아온다.

이때 DNS서버에서는 어떤 일들이 벌어지는지 알아보자.

클라이언트에서 보낸 조회 메시지에는 

- 이름 (ex. `www.naver.com`)
- 클래스 (ex. `IN`)
- 타입 (ex. `A`, `MX`)

세 가지의 정보를 가진다.

DNS서버에서 각각의 정보와 모두 일치하는 것을 찾고, 그에 해당하는 저장되어있는 IP주소를 회답한다.

`A`라는 클래스는 IP주소를 조회할 때, `MX` 클래스의 경우는 메일 배송 목적지를 조회할 때 사용된다. 

DNS서버가 무한한 용량을 가지는 것은 아닐텐데, 전세계의 수 많은 서버들은 어떻게 등록되어 있길래  언제든지 모든 서버를 조회할 수 있는 것일까?



### 도메인

DNS는 회사 부서처럼 계층을 이루며 연결되어 있다. 그 계층을 살펴보기 위해 도메인에 대해서 알아보자.

`www.google.co.kr`이라는 주소에 대해서 분석해보면 `kr` -> `co` -> `google` -> `www` 이런식으로 구성되어 있을것이다. 각각의 도메인 정보를 DNS서버에 분리하여 등록한다면 체계적으로 검색이 가능하다 `kr`이 가장 상위의 구조

하위에서 상위로 올라가며 검색을 하는데, `www.google.co.kr`의 DNS서버를 `google.co.kr`의 DNS서버에 등록하고, 이것을 `co.kr`, `kr`순으로 등록하여 순차적으로 담당 DNS서버에 접근할 수 있다.



### 루트 도메인

`kr`이 최상위 도메인처럼 보이지만, 모든 인터넷 도메인은 `root`도메인을 최상위 도메인으로 가진다. 모든 인터넷 도메인의 최상위 도메인인 `root`도메인을 다시 모든 DNS에 등록을 해두면, 아까와는 다르게 `root`도메인을 경유해 상위에서 하위로 이동하며 원하는 DNS서버에 도착할 수 있다.



### 캐시의 활용

하나의 DNS에 하나의 도메인을 가진다면 위 방법으로 담당DNS를 찾는데 문제가 없을 것이다. 하지만 현실에서는 DNS서버에 상위와 하위의 도메인을 갖을 수도 있고, 복수의 도메인을 갖기 때문에 찾는게 시간이 오래 걸릴 수 도 있다. 이럴때 DNS서버에 캐시를 활용하여 한 번 조사하였던 이름의 유무를 빠르게 회답할 수 있다. 메모리나 디스크 장치 뿐만 아니라 네트워크에서도 사용이 된다. 캐시에 있는 정보는 항상 올바르다고 할 수 없기 때문에 유효기간을 설정하여 삭제할 수 있다.

